# 03 - STATE标准（状态机工作流）

> **阅读时间**：10分钟  
> **目标**：学会设计AI员工的工作流程，明确什么时候自动，什么时候停

---

## 什么是STATE？

**STATE** = **S**tatus（状态）+ **T**ransition（流转）+ **A**ction（动作）+ **T**rigger（触发）+ **E**xit（出口）

**核心作用**：
> 定义AI员工的工作状态，明确什么时候全自动，什么时候暂停等人类，什么时候必须人工介入。

**类比**：工厂的生产线流程图

---

## 六大状态类型

| 状态 | 图标 | 含义 | AI行为 | 人类行为 |
|------|------|------|--------|----------|
| **IDLE** | ⚪ | 空闲态 | 待命，监听触发 | 随时启动新任务 |
| **AUTO** | 🟢 | 自动态 | 全自动执行 | 监控即可 |
| **WAIT** | 🟡 | 等待态 | 暂停，提供选项 | 选择/修改/确认 |
| **CHECK** | 🔵 | 检查态 | 自我验证 | 等待结果 |
| **LOOP** | 🟣 | 循环态 | 批量处理 | 可随时暂停 |
| **HALT** | 🔴 | 停止态 | 停止，报告异常 | 处理异常，给指令 |

---

## 状态详解

### ⚪ IDLE（空闲态）

**定义**：待命状态，等待指令

**触发条件**：
- 任务完成
- 初始化完成
- 用户主动结束

**示例**：
```
[IDLE] 等待用户指令...
用户："今天想做武侠题材的视频"
  ↓
[AUTO] 启动选题流程
```

---

### 🟢 AUTO（自动态）

**定义**：AI全自动执行，无需人类干预

**适用场景**：
- 数据分析
- 批量处理
- 规则明确的计算

**示例**：
```
[AUTO] AI扫描热点榜单，筛选50个候选
[AUTO] 根据历史数据，打分排序
[AUTO] 提取TOP 5
  ↓
[WAIT] 暂停，等待人类选择
```

**时间限制**：
- 建议单次AUTO不超过3分钟
- 超过3分钟，人类会失去耐心
- 长任务拆分成多个短AUTO

---

### 🟡 WAIT（等待态）

**定义**：AI完成当前步骤，暂停等待人类决策

**适用场景**：
- 需要人类选择（选A还是选B）
- 需要人类确认（"这样可以吗？"）
- 需要人类输入（"请提供更多信息"）

**示例**：
```
[WAIT] AI已生成3版提示词
──────────────────────
请选择（输入数字1-3）：
1️⃣ 版本A：古装侠客，现代办公室...
2️⃣ 版本B：武侠高手，面试场景...
3️⃣ 版本C：剑客送外卖，飞檐走壁...

或输入你的想法：_____

⏱️ 30秒后自动选择版本1
──────────────────────
```

**超时机制**：
- 建议设置30-60秒超时
- 超时后自动选择默认选项
- 避免无限等待

---

### 🔵 CHECK（检查态）

**定义**：AI自我验证，检查质量是否达标

**适用场景**：
- 自检输出质量
- 验证数据完整性
- 检查安全合规

**示例**：
```
[CHECK] AI自检：提示词质量评分
──────────────────────
✓ 完整性：包含主体+动作+场景
✓ 具体性：动作描述清晰
✓ 格式规范：中英双语
✗ 创新性：类似提示词已存在

总分：85/100 ✅ 通过
──────────────────────
  ↓
[AUTO] 继续下一步
```

**不通过处理**：
```
[CHECK] 总分：65/100 ❌ 不通过
原因：缺少光影描述，动作太笼统
  ↓
[AUTO] 自动优化后重新生成
或
[WAIT] 等待人类手动修改
```

---

### 🟣 LOOP（循环态）

**定义**：批量处理中，重复执行同类型任务

**适用场景**：
- 批量生成（一次生成10条文案）
- 批量处理（处理100条数据）
- 批量检查（审核50个视频）

**示例**：
```
[LOOP] 批量生成文案 3/10
━━━━━━━━━━░░░░░░░░░░ 30%

当前：第3条 - 修仙者挤地铁
进度：文案生成中...

[暂停] [查看详情] [全部取消]
```

**可随时**：
- 暂停（转为WAIT）
- 查看当前进度
- 取消剩余任务

---

### 🔴 HALT（停止态）

**定义**：遇到异常或限制，必须人工介入

**触发条件**：
- AI无法处理（技术限制）
- 检测到风险（安全/合规）
- 质量连续不合格（3次自检失败）
- 外部API故障（即梦服务不可用）

**示例**：
```
[HALT] ⚠️ 需要人工处理
──────────────────────
原因：AI无法直接调用即梦API

当前状态：
✓ 选题已完成
✓ 提示词已生成
✓ 文案已生成
✗ 视频生成（需人工操作）

下一步操作指南：
1. 打开即梦网站：jimeng.jianying.com
2. 选择"视频生成"
3. 粘贴以下提示词：
   [提示词内容]
4. 点击生成，等待2-3分钟
5. 下载视频后，上传到这里

[我已完成上传] [需要帮助] [取消任务]
──────────────────────
```

---

## 状态流转规则

### 正常流程

```
[IDLE] 启动
  ↓
[AUTO] 全自动处理
  ↓
[WAIT] 等人类决策
  ↓（人类确认）
[CHECK] AI自检
  ↓（通过）
[AUTO] 继续处理
  ↓
[IDLE] 完成，待命
```

### 异常流程

```
[CHECK] 自检不通过
  ↓（自动重试）
[LOOP] 最多重试3次
  ↓（仍不通过）
[HALT] 停止，报告异常
  ↓（人类处理）
[WAIT] 等人类修改
  ↓（人类确认）
[CHECK] 再次自检
```

### 关键原则

1. **每个WAIT必须有超时机制**
2. **每个CHECK必须有通过/不通过标准**
3. **每个HALT必须给明确的处理指南**
4. **AUTO超过3分钟要拆分成多个短AUTO**

---

## 完整示例：视频创作流程

```
[IDLE] 每天早上8:00自动启动（定时触发）
  ↓
[AUTO] 扫描热点榜单，筛选50个候选（耗时10秒）
  ↓
[AUTO] 根据历史数据，打分排序（耗时5秒）
  ↓
[WAIT] 推送TOP 5给用户（附带数据）
  ↓ 用户选择选题A（或超时自动选第1个）
[AUTO] 分析选题A的成功案例（耗时10秒）
  ↓
[AUTO] 生成3版Seedance提示词（耗时20秒）
  ↓
[WAIT] 展示3版，等用户选择（30秒超时）
  ↓ 用户选择第2版
[CHECK] AI自检：提示词质量评分（标准：>85分）
  ↓ 评分88分，通过
[AUTO] 生成配套文案（4平台版本）（耗时10秒）
  ↓
[WAIT] 展示文案，等用户确认
  ↓ 用户点击"确认生成"
[HALT] AI无法直接生成视频（API限制），给出操作指南
  ↓ 用户手动去即梦生成视频
[WAIT] 等用户上传成品视频
  ↓ 用户上传视频
[AUTO] 提取视频特征，记录数据（耗时5秒）
  ↓
[IDLE] 任务完成，等待下一条指令
```

**流程统计**：
- 总步骤：11个
- AUTO节点：6个（全自动）
- WAIT节点：3个（需人类确认）
- CHECK节点：1个（AI自检）
- HALT节点：1个（需人工操作）
- 预计人类参与时间：5-10分钟
- 预计AI自动运行时间：1-2分钟

---

## 自检清单

设计STATE工作流时，检查：

- [ ] 有明确的启动条件（什么触发IDLE→AUTO）
- [ ] 每个WAIT有超时机制（30-60秒）
- [ ] 每个CHECK有明确的通过标准
- [ ] 每个HALT给人类清晰的操作指南
- [ ] 有异常处理分支（不是只有主流程）
- [ ] 人类参与节点不超过30%（避免太繁琐）
- [ ] 有明确的结束状态（回到IDLE）

---

**[→ 04 - IOCA标准](04-IOCA.md)**
